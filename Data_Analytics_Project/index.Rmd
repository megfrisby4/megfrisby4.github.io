---
output: 
  html_document:
    toc: yes
    toc_float:
      collapsed: false
pagetitle: Data Analytics Final Project
title: "Data Analytics Final Project - Constructing a Viral Phylogenetic Tree"
---
## Order Mononegavirales 
### If you didn't think english could get any harder... there's Latin
<iframe width="560" height="315" src="https://www.youtube.com/embed/EXfB2YCeTDI?start=2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

Mononegavirales are an order of single stranded negative sense RNA viruses comprising 11 virus families of which many members are capable of causing significant human disease (or disease of vertebrate animalia). These viruses consist of non segmented genomes ranging from 8-20KB in length (8,00 - 20,000 base pairs or about 3,00-7,00 amino acids). Most viruses of the order Mononegavirales replicate in host-cell cytoplasm (with the exception of certain Bornaviruses which replicate in the nuclei), and once abundant in the host body can attack the immune, nervous, excretory, and other major organ systems causing a vast range of symptoms with varied severity. It is important to note that not all Mononegavirus infections are symptomatic, or severe.  Some examples of Mononegavirales capable of causing infection in humans are Nipah virus, Ebola, Rabies virus, Measles virus and Mumps virus.

As with many viruses, understanding their evolutionary relationships is exceedingly important to the preservation of public health, especially in underdeveloped countries. 

Pylogenies are very important for viral studies especially concerning viral evolution of potentially life threatening diseases. 

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(readr)
library(kableExtra)

```


## A download of the fasta file i created (220 complete viral genomes)
[complete list of virus genomes](http://megfrisby4.github.io/Data_Analytics_Project/Data/virus_genomes.FASTA)
-warning...it's a big old honker (2.9MB) beware!

## What I have so far.... (my exploratory code...definetly unfinished)
a few packages I need to construct my phylogeny (and acquire the correct data from NCBI):

## Data 
The data table of many tears!

```{r}
   readr::read_csv("./Data/Virus_species_and_accession_data.csv") %>% kableExtra::kable() %>% kableExtra::kable_classic(lightable_options = 'hover') %>% kableExtra::scroll_box(width="500px", height = "200px")
```


## Using rentrez to explore sequences from NCBI nucleotide database 

some initial setup 
db = "nucleotide" indicates that I will be using accessing NCBI's nucleotide database.
rettype = "fasta" indicates each nucleotide sequence will be returned to me in fasta format 


Here I am just exploring some functions from the new packages I downloaded. The entrez_fetch allows me to retrieve full genome nucleotide sequences from the NCBI database according to a unique accession number assigned to a tested viral sample.
The cat function organizes the sequence line by line so it is a bit easier to look at. 
Here I recall the full genomic sequence for Lloviu Cuevavirus and organize it in an easy to read format using cat
The genome is incredibly long so I will hide the output 

## use this to explain why phylogenies are important... even viruses in the same family can greatly differ!

Here I recall all the genomes of viruses in the family filoviridae by accession number in fasta format and make a list of the sequences manually 

I can access any sequence from the list like this:
filolist$[name of filo virus species]
Here's a sneak peek at the genome of the Bombali Ebolavirus:

## Exploring a bit of pairwise alignment
I can do a simple pairwise alignment with the Biostrings function pairwiseAlignment.
Here is the pairwise alignment of Bundibugyo and Reston Ebolaviruses:

In general, the lower the score, the more  the genomes differ,  the higher the score the more similar the genomes are.
However, pairwise alignments scores are not very intuitive in and of themselves. 
Another function will tell us what percentage of the genomes align (pairwise sequence identity), a much more intuitive result!

All in all, these viruses share only 63.31% sequence identity! This goes to show how incredibly diverse viruses, even within the same family can be, and why they are so terrifying!

I predicted Bundibugyo ebolaviruse and Reston Ebolavirus would be quite different and they are in fact very diverse characteristically in both geographic origin and host range. 

Let's take a look at 2 viruses I believe will be more genetically similar, 2 different strains of Marburg Ebolavirus. 



A much higher score, but again, rather uninformative, and un-intuitive, lets have a look at the pid (percent identity)

These genomes share about 79.3% sequence identity! They have much more in common than the previous two viruses, yet are still in the same family (taxonomic grouping)

## Pulling out the big guns: recalling and assembling 220 viral genomes 


I am going to load and utilize the BiomaRt package which helps my system to process and comprehend large amounts of data, then I will assemble a single list of complete genome sequences using my selection of accession numbers (corresponding to specific viruses) in fasta format.
I will accomplish this using the entrez_fetch_list() function from the campbio4all package.

**Note**: access the FASTA I created of all 220 complete viral genomes with the link at the top of this webpage, you can view every single nucleotide for yourself! 

Creating a vector of family names that corresponds to the virus accession numbers.
Checking the length to make sure every genome is accounted for. 
Concatenating the accession number and family name into a data frame.
Saving as a csv for further display/use.

## How I got my data table....
this was surprisingly hard but I harnessed my knowledge of lists and cleaning data and I did it and Im very happy because there was no way that I could just download this information.... that I knew of! So im proud I was able to use for loops and do this yay!

anyways heres the code for that:

## Making all the sequences in my list useable! 

Cleaning the sequences into a neat format I can perform alignments on!
Here is a peek:

Making the list into a single vector of length 220 (one character string for each genome)
Im starting with an empty vector that I can then fill up, the output is literally a vector of 220 NA's:

Then I fill the  vector, replacing each NA with a full genome sequence.
As you can see the vector no longer cosistis of NA's, it now consists of DNA sequences. 

I will give the vector the virus names from what I extracted in the orginal fasta file previously 

## Converting to a stringset using BioStrings

Converting my newly made vector into a biostrings DNA stringset: 
This I did in another script and saved as an RDS. It took about 2 hours to run so I am just importing it!

mwhahahaha mad scientist moment!
**just a quick note**, most mononegavirales have rna genomes, as you can see, these sequences (and they are also this way in NCBI) represent DNA genomes, so keep in mind this would be the compliment to the actual viral genomes. The analyses will still work the same because these are all RNA viruses and so we are performing an analysis on all of their compliments, and their compliments are as equal to each other as their actual genomes are

## Performing Multiple sequence alignment 
How genomes align relative to eachother give scientists the information needed to construct a phylogenetic tree. An informative diagram of virus's evolutionary relationship to each other. 

phylogenetic trees are very important to pathology and entomology as they can help scientists predict properties of newly discovered viral species such as pathogenicity, zoonotic potential, vectorization method, and host range. 

again I am importing this from another script as an RDS
The actual command is commented.

by default the alignseqs function creates a DNA stringset object, I must convert this into a DNAMultipleAlingment object so that alignment can be used to create my phylogenetic tree.
I can do this with the following code 

I want to work with this object with functions from the seqinr package so Ill need to do a little more tweaking with a function called msaConvert
I will name the new object I am creating virus_align_seqinr so that I can get it all straight
the output is incredibly long there are 220 genomes here... so I will not show you.....youre welcome!

## Representing my multiple sequence alingment as an R plot  
using ggmsa package (and function) to plot my virus_alignment... not the one that has been adjusted for seqinR, only the original alignment will allow for this to work correctly:

## Creating a genetic distance matrix
Genetic distance is another way of saying evolutionary distance, or how closely two organisms are related. Phylogenetic trees visually explain genetic distance. 
In simple terms, the more alike the genomes are (more nucleotides that are the same, the less genetic distance there is between them and the less evolution has occured)

I will calculate the genetic distance of my viral genomes from eachother using the DistanceMatrix() function. 

an object of class 'dist' is produced

The matrix will be easier to view if it is rounded off... we can use the round function for that

## Building a phylogenetic tree.... Finally!
There are many methods of building a phylogenetic tree, I will use the neighbor joininng algorithm (nj()). This will use genetic distances to cluster sequences into clades

I will not use rounded values to build by phylogenetic tree

#Plotting The Phylogenetic Tree
Using the plot.phylo() function to create the phylogenetic tree, and adding a label

The tree is now rooted with groups defined, but the branch lengths still have absolutely no meaning. 

We can include information about branch length by using use.edge.length = T

The length of branches now reflect evolutionary distances/relationships between the viruses. 

**only the vertical lines have meaning**


